{% extends "layout.html" %}
{% block body %}
<script>
	var todayDate = moment().startOf('day');
	var YESTERDAY = todayDate.clone().subtract(1, 'day').format('YYYY-MM-DD');
	var TODAY = todayDate.format('YYYY-MM-DD');
	var TOMORROW = todayDate.clone().add(1, 'day').format('YYYY-MM-DD');
	
	$(document).ready(function() {
		$('#calendar').fullCalendar({
			schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
			now: TODAY,
			editable: true,
			aspectRatio: 1.8,
			scrollTime: '00:00',
			//slotDuration: '00:30:00',
			snapDuration: '00:30:00',
			header: {
				left: 'today prev,next',
				center: 'title',
				right: 'timelineDay,timelineWeek,month'
			},
			businessHours: {
				// days of week. an array of zero-based day of week integers (0=Sunday)
				dow: [ 0, 1, 2, 3, 4, 5, 6 ], // Monday - Thursday

				start: '06:00', // a start time (10am in this example)
				end: '22:00', // an end time (6pm in this example)
			},
			defaultView: 'timelineWeek',
			nowIndicator  : true,
			allDaySlot : false,
			dayClick: function(start, end, jsEvent, view, resource) {
				alert(jsEvent);
				$(".modal-body #resourceId").val( resource.id );
				$(".modal-body #dataInizio").val( moment(start).format("YYYY-MM-DD") );
				$(".modal-body #oraInizio").val( moment(start).format("HH:mm") );
				$(".modal-body #dataFine").val( moment(end).format("YYYY-MM-DD") );
				$(".modal-body #oraFine").val( moment(end).format("HH:mm") );
				$('#myModal').modal('show');
			},
			eventClick: function(calEvent, jsEvent, view) {

				//alert('Event: ' + calEvent.title + "(" + calEvent.id + ")");
				//alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
				//alert('View: ' + view.name);
				var eventId = calEvent.id;
				$(".modal-body #eventId").val( eventId );
				$(".modal-body #resourceId").val( calEvent.resourceId );
				$(".modal-body #dataInizio").val( moment(calEvent.start).format("YYYY-MM-DD") );
				$(".modal-body #oraInizio").val( moment(calEvent.start).format("HH:mm") );
				$(".modal-body #dataFine").val( moment(calEvent.end).format("YYYY-MM-DD") );
				$(".modal-body #oraFine").val( moment(calEvent.end).format("HH:mm") );
				$('#myModal').modal('show');

				// change the border color just for fun
				$(this).css('border-color', 'red');

			},
			selectable: true,
			/*select: function( start, end, jsEvent, view, resource) {
				alert('nuovo turno per ' + resource.title);
			},*/
			views: {
				timelineThreeDays: {
					type: 'timeline',
					duration: { days: 3 }
				}
			},
			selectable: true,
			minTime: '06:00:00',
			maxTime: '22:00:00',
			resourceAreaWidth: '20%',
			resourceColumns: [
				{
					labelText: 'Dipendente',
					field: 'title'
				}
			],
			resources: {
				url: '/api/v1/dipendenti',
				type: 'GET'
			},
			events: '/api/v1/events'
		});

	});
</script>


<div id='calendar'></div>
<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Modifica</h4>
      </div>
      <div class="modal-body">
		id dipendente:<input type="text" name="resourceId" id="resourceId" value=""/><br />
        da:<input type="date" name="dataInizio" id="dataInizio" value=""/>
		<input type="time" name="oraInizio" id="oraInizio" value=""/><br />
		a:<input type="date" name="dataFine" id="dataFine" value=""/>
        <input type="time" name="oraFine" id="oraFine" value=""/><br />
		id evento:<input type="text" id="eventId" name="id" value=""/>
        <p>
            {#<a href="{{url_for('nuovo')}}"type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button></p>#}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
{% endblock %}